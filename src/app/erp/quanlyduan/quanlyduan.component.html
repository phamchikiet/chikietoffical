<div class="flex flex-row h-screen w-screen">
  <div class="flex flex-col justify-between {{
      leftsidebar ? '' : 'hidden'
    }} bg-slate-50 min-w-14 h-screen overflow-auto p-1">
    <a href="/" mat-icon-button class="hover:bg-slate-200 rounded-full p-2">
      <img src="logo.jpg" class="w-10 hover:bg-slate-50 hover:border-blue-500" />
    </a>
    <div class="flex flex-col space-y-2 w-full">
      <button mat-icon-button class="hover:bg-slate-200 rounded-full p-2">
        <span class="material-symbols-outlined">home</span>
      </button>
      <button mat-icon-button class="hover:bg-slate-200 rounded-full p-2">
        <span class="material-symbols-outlined">dashboard</span>
      </button>
      <button mat-icon-button class="hover:bg-slate-200 rounded-full p-2">
        <span class="material-symbols-outlined">folder</span>
      </button>
      <button mat-icon-button class="hover:bg-slate-200 rounded-full p-2" [routerLink]="['/profile']">
        <span class="material-symbols-outlined">account_circle</span>
      </button>
      <button mat-icon-button class="hover:bg-slate-200 rounded-full p-2" (click)="logout()">
        <span class="material-symbols-outlined">logout</span>
      </button>
    </div>
  </div>

  <div class="flex flex-col h-screen w-full">
    <!-- <mat-drawer-container class="h-screen w-full" autosize>
      <mat-drawer #drawer [opened]="isOpen" [mode]="drawerMode" position="end" class="bg-white flex flex-col h-full lg:w-2/3 w-full">
        <p>Auto-resizing sidenav</p>
          <p>Lorem, ipsum dolor sit amet consectetur.</p>
      </mat-drawer>

      <div class="example-sidenav-content">
        <button type="button" mat-button (click)="drawer.toggle()">
          Toggle sidenav
        </button>
      </div>

    </mat-drawer-container> -->

    <mat-drawer-container class="flex-grow">
      <mat-drawer #drawer position="end" class="bg-white flex flex-col h-full lg:!w-2/3 !w-full">
        <router-outlet></router-outlet>
      </mat-drawer>
      <mat-drawer-content>
        <div class="flex flex-col h-full justify-between p-4">
          <div class="relative flex justify-between items-center">
            <mat-form-field appearance="outline" class="w-full" subscriptSizing="dynamic">
              <mat-label>Tìm Kiếm</mat-label>
              <input matInput (keyup)="applyFilter($event)" />
              <button mat-icon-button matPrefix>
                <span class="material-symbols-outlined">search</span>
              </button>
            </mat-form-field>
            <div class="relative">
              <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="More options">
                <span class="material-symbols-outlined">more_vert</span>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item>
                  <div class="flex flex-row justify-center items-center">
                    <span class="material-symbols-outlined mr-2">add_circle</span>
                    <span>Thêm Mới</span>
                  </div>
                </button>
              </mat-menu>
            </div>
          </div>
          <div class="my-2 relative flex flex-col h-full overflow-auto">
            <mat-tree class="cursor-pointer" [dataSource]="dataSource" [treeControl]="treeControl">
              <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
                <div class="w-full flex items-center justify-between">
                  <button mat-icon-button disabled></button>
                  @if(node.node.TypeMenu == 'Task'){
                    <a (click)="drawer.open()" [routerLink]="'task/'+node.node.id" routerLinkActive="bg-slate-200" class="hover:bg-slate-200 rounded-lg p-2 truncate flex-grow">{{ node.node.Title }}</a>
                  }@else{
                    <span class="hover:bg-slate-200 rounded-lg p-2 truncate flex-grow">{{ node.node.Title }}</span>
                  }
                  <button mat-icon-button [matMenuTriggerFor]="menu1">
                    <span class="material-symbols-outlined">more_vert</span>
                  </button>
                  <mat-menu #menu1="matMenu">
                    <button mat-menu-item (click)="addTask(dialogTask)">
                      <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-green-600 mr-2">add_circle</span>
                        <span>Thêm Mới</span>
                      </div>
                    </button>
                    @if(node.node.TypeMenu == 'Task'){
                      <button mat-menu-item (click)="updateTask(dialogUpdateTask);Task=node.node">
                        <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-blue-600 mr-2">edit</span>
                        <span>Chỉnh Sửa</span>
                        </div>
                      </button>
                    }@else{
                      <button mat-menu-item (click)="updateCategory(dialogUpdateCategory);Category=node.node">
                        <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-blue-600 mr-2">edit</span>
                        <span>Chỉnh Sửa</span>
                        </div>
                      </button>
                    }

                    @if(node.node.TypeMenu == 'Task'){
                      <button mat-menu-item (click)="deleteTask(dialogDeleteTask);Category=node.node">
                        <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-red-600 mr-2">delete</span>
                        <span>Xoá</span>
                      </div>
                    </button>
                    }@else{
                      <button mat-menu-item (click)="deleteCategory(dialogDeleteCategory);Category=node.node">
                        <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-red-600 mr-2">delete</span>
                        <span>Xoá</span>
                      </div>
                    </button>
                    }

                  </mat-menu>
                </div>
              </mat-tree-node>
              <mat-tree-node class="w-full" *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>

                <div class="w-full flex items-center justify-between">
                  <a mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.node.Title">
                    <span class="material-symbols-outlined">
                      {{
                      treeControl.isExpanded(node)
                      ? "expand_more"
                      : "chevron_right"
                      }}
                    </span>
                  </a>
                  <span class="hover:bg-slate-200 rounded-lg p-2 truncate flex-grow">{{
                    node.node.Title
                    }}</span>
                <div>
                  <button mat-icon-button [matMenuTriggerFor]="menu1">
                    <span class="material-symbols-outlined">more_vert</span>
                  </button>
                  <mat-menu #menu1="matMenu">
                    <button mat-menu-item (click)="addTask(dialogTask)">
                      <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-green-600 mr-2">add_circle</span>
                        <span>Thêm Mới</span>
                      </div>
                    </button>
                    <button mat-menu-item (click)="editItem(node)">
                      <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-blue-600 mr-2">edit</span>
                        <span>Chỉnh Sửa</span>
                        </div>
                    </button>
                    <button mat-menu-item (click)="removeItem(node)">
                      <div class="flex flex-row items-center">
                        <span class="material-symbols-outlined text-red-600 mr-2">delete</span>
                        <span>Xoá</span>
                      </div>
                    </button>
                  </mat-menu>
                </div>
                </div>
              </mat-tree-node>
            </mat-tree>
          </div>
          <div class="relative flex flex-row justify-center items-center">
            sadasdsa
          </div>
        </div>
      </mat-drawer-content>
    </mat-drawer-container>
  </div>
</div>

<ng-template #dialogTemplate>
  <div class="lg:min-w-[40vw] min-w-[90vw] min-h-[50vh] flex flex-col justify-between space-y-3 p-4">
    <div class="h-full flex flex-col space-y-2">
      <div class="text-center text-xl font-bold">Thêm Mới</div>
      <div class="flex flex-col justify-start w-full space-y-4 p-4">
        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Tiêu Đề</mat-label>
          <input (input)="ToSlug()" matInput [(ngModel)]="Category.Title" [ngModelOptions]="{ standalone: true }"
            placeholder="Tiêu Đề" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Slug</mat-label>
          <input matInput [(ngModel)]="Category.Slug" [ngModelOptions]="{ standalone: true }" placeholder="Slug" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-select [(ngModel)]="Category.location" [ngModelOptions]="{ standalone: true }">
            <mat-option *ngFor="let item of ['top', 'main', 'bottom']" [value]="item">
              {{ item }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div mat-dialog-actions [align]="'end'" class="justify-center">
      <button mat-flat-button color="warn" mat-dialog-close="false">Huỷ</button>
      <button mat-flat-button color="primary" mat-dialog-close="true">
        Đồng Ý
      </button>
    </div>
  </div>
</ng-template>

<ng-template #dialogUpdateCategory>
  <div class="lg:min-w-[40vw] min-w-[90vw] min-h-[50vh] flex flex-col justify-between space-y-3 p-4">
    <div class="h-full flex flex-col space-y-2">
      <div class="text-center text-xl font-bold">Cập Nhật</div>
      <div class="flex flex-col justify-start w-full space-y-4 p-4">
        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Tiêu Đề</mat-label>
          <input (input)="ToSlug()" matInput [(ngModel)]="Category.Title" [ngModelOptions]="{ standalone: true }"
            placeholder="Tiêu Đề" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Slug</mat-label>
          <input matInput [(ngModel)]="Category.Slug" [ngModelOptions]="{ standalone: true }" placeholder="Slug" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-select [(ngModel)]="Category.pid" [ngModelOptions]="{ standalone: true }">
            <mat-option *ngFor="let item of Categories" [value]="item.id">
              {{ item.Title }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div mat-dialog-actions [align]="'end'" class="justify-center">
      <button mat-flat-button color="warn" mat-dialog-close="false">Huỷ</button>
      <button mat-flat-button color="primary" mat-dialog-close="true">
        Đồng Ý
      </button>
    </div>
  </div>
</ng-template>

<ng-template #dialogTask>
  <div class="lg:min-w-[40vw] min-w-[90vw] min-h-[50vh] flex flex-col justify-between space-y-3 p-4">
    <div class="h-full flex flex-col space-y-2">
      <div class="text-center text-xl font-bold">Thêm Mới</div>
      <div class="flex flex-col justify-start w-full space-y-4 p-4">
        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Tiêu Đề</mat-label>
          <input (input)="ToSlugTask()" matInput [(ngModel)]="Task.Title" [ngModelOptions]="{ standalone: true }"
            placeholder="Tiêu Đề" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Slug</mat-label>
          <input matInput [(ngModel)]="Task.Slug" [ngModelOptions]="{ standalone: true }" placeholder="Slug" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-select [(ngModel)]="Task.idDM" [ngModelOptions]="{ standalone: true }">
            <mat-option *ngFor="let item of Categories" [value]="item.id">
              {{ item.Title }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div mat-dialog-actions [align]="'end'" class="justify-center">
      <button mat-flat-button color="warn" mat-dialog-close="false">Huỷ</button>
      <button mat-flat-button color="primary" mat-dialog-close="true">
        Đồng Ý
      </button>
    </div>
  </div>

</ng-template>
<ng-template #dialogUpdateTask>
  <div class="lg:min-w-[40vw] min-w-[90vw] min-h-[50vh] flex flex-col justify-between space-y-3 p-4">
    <div class="h-full flex flex-col space-y-2">
      <div class="text-center text-xl font-bold">Thêm Mới</div>
      <div class="flex flex-col justify-start w-full space-y-4 p-4">
        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Tiêu Đề</mat-label>
          <input (input)="ToSlugTask()" matInput [(ngModel)]="Task.Title" [ngModelOptions]="{ standalone: true }"
            placeholder="Tiêu Đề" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Slug</mat-label>
          <input matInput [(ngModel)]="Task.Slug" [ngModelOptions]="{ standalone: true }" placeholder="Slug" />
        </mat-form-field>

        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-select [(ngModel)]="Task.idDM" [ngModelOptions]="{ standalone: true }">
            <mat-option *ngFor="let item of Categories" [value]="item.id">
              {{ item.Title }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div mat-dialog-actions [align]="'end'" class="justify-center">
      <button mat-flat-button color="warn" mat-dialog-close="false">Huỷ</button>
      <button mat-flat-button color="primary" mat-dialog-close="true">
        Đồng Ý
      </button>
    </div>
  </div>
</ng-template>

<ng-template #dialogView>
  <div class="w-full flex flex-col">
    <div mat-dialog-title>Thêm Mới</div>
    <div mat-dialog-content>
      <div class="flex flex-col w-full space-y-4 p-4">
        <mat-form-field subscriptSizing="dynamic" appearance="outline" class="w-full">
          <mat-label>Tiêu Đề</mat-label>
          <input matInput [(ngModel)]="Detail.Title" [ngModelOptions]="{ standalone: true }" placeholder="Tiêu Đề" />
        </mat-form-field>

        <mat-select [(ngModel)]="Detail.location" [ngModelOptions]="{ standalone: true }" subscriptSizing="dynamic"
          appearance="outline" class="w-full">
          <mat-option *ngFor="let item of ['top', 'main', 'bottom']" [value]="item">
            {{ item }}
          </mat-option>
        </mat-select>
      </div>
    </div>
    <div mat-dialog-actions [align]="'end'" class="justify-center">
      <button mat-flat-button color="warn" mat-dialog-close="false">Huỷ</button>
      <button mat-flat-button color="primary" mat-dialog-close="true">
        Đồng Ý
      </button>
    </div>
  </div>
</ng-template>

<ng-template #dialogDeleteTask>
  <div class="flex flex-col space-y-3">
    <div mat-dialog-title>Xoá</div>
    <div mat-dialog-content>
      <div class="flex flex-col w-full space-y-4 lg:p-4">
        Bạn chắc chắn muốn Xoá?
      </div>
      <div class="flex flex-row space-x-2 items-center justify-center">
        <button mat-flat-button color="warn" mat-dialog-close="false">
          Huỷ
        </button>
        <button mat-flat-button color="primary" mat-dialog-close="true">
          Đồng Ý
        </button>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #dialogDeleteCategory>
  <div class="flex flex-col space-y-3">
    <div mat-dialog-title>Xoá</div>
    <div mat-dialog-content>
      <div class="flex flex-col w-full space-y-4 lg:p-4">
        Bạn chắc chắn muốn Xoá?
      </div>
      <div class="flex flex-row space-x-2 items-center justify-center">
        <button mat-flat-button color="warn" mat-dialog-close="false">
          Huỷ
        </button>
        <button mat-flat-button color="primary" mat-dialog-close="true">
          Đồng Ý
        </button>
      </div>
    </div>
  </div>
</ng-template>
